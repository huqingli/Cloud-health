package com.moy.activity;

import org.json.JSONException;
import org.json.JSONObject;

import com.moy.handler.ResultAboutTestHandler;
import com.moy.pojo.ResultAnalysisPOJO;
import com.moy.util.MyApplication;

import android.app.Activity;
import android.os.Bundle;
import android.os.StrictMode;
import android.util.Log;
import android.view.Window;
import android.view.View;
import android.view.View.OnClickListener;
import android.webkit.WebView;
import android.widget.TextView;
import android.widget.Toast;

public class FoodActivity extends Activity implements OnClickListener{
	
	private MyApplication application;
	private String userName;
	private TextView tv_good;
	private TextView tv_bad;
	private TextView tv_grade;
	private TextView tv_food;
	private ResultAnalysisPOJO fo = new ResultAnalysisPOJO();
	
	private int rate = 0;
	
	
	
	@Override
	public void onCreate(Bundle savedInstanceState){
    	///在Android2.2以后必须添加以下代码
		//本应用采用的Android4.0
		//设置线程的策略
		 StrictMode.setThreadPolicy(new StrictMode.ThreadPolicy.Builder()   
         .detectDiskReads()   
         .detectDiskWrites()   
         .detectNetwork()   // or .detectAll() for all detectable problems   
         .penaltyLog()   
         .build());   
		//设置虚拟机的策略
		  StrictMode.setVmPolicy(new StrictMode.VmPolicy.Builder()   
		         .detectLeakedSqlLiteObjects()   
		         //.detectLeakedClosableObjects()   
		         .penaltyLog()   
		         .penaltyDeath()   
		         .build());
		super.onCreate(savedInstanceState);
		requestWindowFeature(Window.FEATURE_NO_TITLE);
		setContentView(R.layout.food);
		
		application = (MyApplication)getApplication();
		userName = application.getUser().getUserName();
		tv_grade = (TextView)findViewById(R.id.grade);
		tv_food = (TextView)findViewById(R.id.food);
		
		/*tv_good = (TextView)findViewById(R.id.good);
		tv_bad = (TextView)findViewById(R.id.bad);
				*/
		
		rate = application.getRate();
		
		//////////////
		//WebView webview=(WebView)findViewById(R.id.webviewfood);
		
	
			
	String result = ResultAboutTestHandler.result(userName, rate);
			
			try{
					JSONObject json = new JSONObject(result);
					if(json.getString("message").equals("fail"))
					{
						Toast.makeText(FoodActivity.this, "请先进行心电检测!", Toast.LENGTH_LONG).show();
					}
					else if(json.getString("message").equals("success"))
					{
						Toast.makeText(FoodActivity.this, "查询成功", Toast.LENGTH_LONG).show();
						Log.i("ResultAct", json.getInt("id")+"");
						Log.i("ResultAct", json.getString("grade"));
						Log.i("ResultAct", json.getString("food"));
						
						fo.setId(json.getInt("id"));
						fo.setGrade(json.getString("grade"));
						fo.setFood(json.getString("food"));

					}
			   }catch(JSONException se){
				   se.printStackTrace();
			   }
			tv_grade.setText(fo.getGrade());
			tv_food.setText(fo.getFood());
			
		/*	tv_good.setText("");
			tv_bad.setText("");
			Toast.makeText(FoodActivity.this, "请先进行心电检测！", Toast.LENGTH_LONG).show();
			*/
			//webview.loadUrl("http://172.18.8.200:8080/moy/food.html");
	

	}

	@Override
	public void onClick(View v) {
		// TODO Auto-generated method stub
		
	}

}
